#!/bin/bash

# Establecer la codificación para caracteres especiales como las tildes y la ñ
export LANG="es_ES.UTF-8"

title="Administración del servidor $(hostname)"

key_ins=($(cat /etc/locale.gen | tail -n +7 | sed 's/^# //'))

actual_key=$(grep -v '^#' /etc/locale.gen | cut -c 2-)
chose=()

for ((i=0; i<${#key_ins[@]}; i+=2)); do

    chose+=("${key_ins[$i]} ${key_ins[$i+1]}" "")

done

message="\n¿Qué distribución de teclado desea tener? Actualmente tiene el teclado: $actual_key"
selected_key=$(dialog --stdout --title "$title" --menu "$message" 0 0 0 "${chose[@]}")

message="\n¿Está seguro que desea cambiar su actual teclado $actual_key, a $selected_key?"
dialog --stdout --title "$title" --yesno "$message" 0 0

if [ $? -eq 0 ]; then

  # Comentar la linea de la distribución del teclado actual
  sed -i "s/^ $actual_key/# $actual_key/" /etc/locale.gen
  
  # Descomentar la linea de la distribución de teclado seleccionada
  sed -i "s/^# $selected_key/  $selected_key/" /etc/locale.gen

fi
